<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pycausalgps.project &mdash; pycausalgps 0.0.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> pycausalgps
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Researchers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup_env.html">Setting Up Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gps.html">Estimating Generalized Propensity Score (GPS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gps.html#computing-gps-values">Computing GPS Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../setup_env_dev.html">Development Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../git_branching.html">Git Branching Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">Modules</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contact.html">Contact Us</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CHANGELOG.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pycausalgps</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>pycausalgps.project</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pycausalgps.project</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">project.py</span>
<span class="sd">================================================</span>
<span class="sd">The core module for the Project class.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">pycausalgps.log</span> <span class="kn">import</span> <span class="n">LOGGER</span>
<span class="kn">from</span> <span class="nn">pycausalgps.database</span> <span class="kn">import</span> <span class="n">Database</span>
<span class="kn">from</span> <span class="nn">pycausalgps.gps</span> <span class="kn">import</span> <span class="n">GeneralizedPropensityScore</span>

<div class="viewcode-block" id="Project"><a class="viewcode-back" href="../../modules.html#pycausalgps.project.Project">[docs]</a><span class="k">class</span> <span class="nc">Project</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Project Class</span>
<span class="sd">    The Project class generates a project object with collecting the project&#39;s</span>
<span class="sd">    details. </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    project_params : dict</span>
<span class="sd">    The parameters of the project. It should contain the following mandotary keys:</span>
<span class="sd">    | name: str</span>
<span class="sd">    | id: int</span>
<span class="sd">    | data.outcome_path: str</span>
<span class="sd">    | data.exposure_path: str</span>
<span class="sd">    | data.covariate_path: str</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The project object does not load the data. It only stores the paths to the data.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; from pycausalgps.project import Project</span>
<span class="sd">    &gt;&gt;&gt; project_params = {&quot;name&quot;: &quot;test_project&quot;, &quot;id&quot;: 1,</span>
<span class="sd">                          &quot;data&quot;: {&quot;outcome_path&quot;: &quot;data/outcome.csv&quot;, </span>
<span class="sd">                                   &quot;exposure_path&quot;: &quot;data/exposure.csv&quot;, </span>
<span class="sd">                                   &quot;covariate_path&quot;: &quot;data/covariate.csv&quot;}}</span>
<span class="sd">    &gt;&gt;&gt; project = Project(project_params = project_params, db_path = &quot;test.db&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_params</span><span class="p">,</span> <span class="n">db_path</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">project_params</span> <span class="o">=</span> <span class="n">project_params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_params</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pr_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pr_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pr_db_path</span> <span class="o">=</span> <span class="n">db_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hash_value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gps_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_hash</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connect_to_database</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_check_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">required_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">]</span>
        <span class="n">required_data_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;outcome_path&quot;</span><span class="p">,</span> <span class="s2">&quot;exposure_path&quot;</span><span class="p">,</span> <span class="s2">&quot;covariate_path&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">required_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_params</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Please provide a value for </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">required_data_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Please provide a value for </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_connect_to_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Projects sqlite database name: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pr_db_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pr_db_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Database is not defined.&quot;</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pr_db_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_input_data_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This includes checking if the data is still accessible. </span>
        <span class="c1"># if the format is supported.</span>
        <span class="c1"># if each data comes with id column.</span>
        <span class="c1"># if the id column matches the id column in the other data.</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="Project.compute_gps"><a class="viewcode-back" href="../../modules.html#pycausalgps.project.Project.compute_gps">[docs]</a>    <span class="k">def</span> <span class="nf">compute_gps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gps_params_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Compute GPS</span>
<span class="sd">        This function computes the GPS for the project.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        | gps_params_path : str </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># This includes loading a yaml file with gps parameters.</span>
        <span class="c1"># and creating a gps object.</span>
        <span class="c1"># The gps object will have access to the data (exposure and covariates.).  </span>
        <span class="c1"># and adding it to the database.</span>
        <span class="c1"># in the gps_param file, if we give more than one gps, it should create different gps objects.</span>

        <span class="c1"># load gps parameters</span>
                <span class="c1"># safe read yaml file</span>
        <span class="k">if</span> <span class="n">gps_params_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">gps_params_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">gps_params</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please provide a yaml file path for the project.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        
        <span class="c1"># compute the combination of providied gps parameters</span>
        <span class="c1"># TODO: If a range of parameters are given we should make decision on how to compute the gps.</span>
        
        
        <span class="c1"># check if they are valid</span>
    
        <span class="c1"># create gps objects based on the parameters. </span>
        <span class="c1"># TODO</span>

        <span class="n">gps</span> <span class="o">=</span> <span class="n">GeneralizedPropensityScore</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_params</span><span class="p">,</span> 
                                         <span class="n">gps_params</span><span class="p">,</span> 
                                         <span class="n">db_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pr_db_path</span><span class="p">)</span>
        
        <span class="c1"># check if the gps is already in the database.</span>
        <span class="k">if</span> <span class="n">gps</span><span class="o">.</span><span class="n">hash_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gps_list</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GPS is already computed, retireving from the database.&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">gps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">gps</span><span class="o">.</span><span class="n">hash_value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gps</span><span class="o">.</span><span class="n">compute_gps</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gps_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gps</span><span class="o">.</span><span class="n">hash_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">gps</span><span class="o">.</span><span class="n">hash_value</span><span class="p">,</span> <span class="n">gps</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hash_value</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div>
        


        <span class="c1"># You can add the gps object to the database, with or without GPS value. We develop the GPS object with all available data and parameters but we do not compute it. </span>
        <span class="c1"># Or we can have a plan to efficiently compute the GPS values. </span>

       

    <span class="c1"># def add_study_data(self, path_to_folder):</span>
    <span class="c1">#     # Adds an instance of input data.</span>
        
    <span class="c1">#     # Read metadata, and create a hash value.</span>
    <span class="c1">#     # Check database to see if it is available, </span>
    <span class="c1">#     #      - if it is, retireve it.</span>
    <span class="c1">#     #      - if not, create a new instance and add to data.base. </span>
        
    <span class="c1">#     # Read yaml file.</span>
    <span class="c1">#     with open(path.join(path_to_folder, &quot;parameters.yml&quot;),</span>
    <span class="c1">#               &quot;r&quot;) as stream:</span>
    <span class="c1">#         try:</span>
    <span class="c1">#             self.data_path = yaml.safe_load(stream)</span>
    <span class="c1">#         except yaml.YAMLError as exc:</span>
    <span class="c1">#             print(exc)</span>

    <span class="c1">#     # collect path</span>

    <span class="c1">#     exp_data_path = self.data_path.get(&quot;exposure&quot;)</span>
    <span class="c1">#     con_data_path = self.data_path.get(&quot;confounder&quot;)</span>
    <span class="c1">#     out_data_path = self.data_path.get(&quot;output&quot;)</span>

    <span class="c1">#     # read data from disk</span>
    <span class="c1">#     try: </span>
    <span class="c1">#         exp_data = pd.read_csv(path.join(path_to_folder, exp_data_path))</span>
    <span class="c1">#         conf_data = pd.read_csv(path.join(path_to_folder, con_data_path))</span>
    <span class="c1">#         out_data = pd.read_csv(path.join(path_to_folder, out_data_path))</span>
    <span class="c1">#     except TypeError as e:</span>
    <span class="c1">#         print(f&quot;Possibly wrong path: &quot; + getattr(e, &#39;message&#39;, repr(e)))</span>
    <span class="c1">#     except FileNotFoundError as e:</span>
    <span class="c1">#         print(e)</span>
    <span class="c1">#     except Exception as e:</span>
    <span class="c1">#         print(e)</span>

    <span class="c1">#     # create StudyData object</span>
    <span class="c1">#     stdata_obj = StudyData(exp_data=exp_data, conf_data=conf_data,</span>
    <span class="c1">#                            outcome_data=out_data)</span>


    <span class="c1">#     if stdata_obj.hash_value in self.study_data:</span>
    <span class="c1">#         print(&quot;Data has been already loaded to the project object.&quot;+\</span>
    <span class="c1">#               &quot;The command is ignored.&quot;)</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         stdata_obj.add_meta_data(self.data_path.get(&quot;metadata&quot;))</span>
    <span class="c1">#         self.study_data.append(stdata_obj.hash_value)</span>
    <span class="c1">#         stdata_obj.set_parent_node = self.hash_value</span>
    <span class="c1">#         self.db.set_value(stdata_obj.hash_value, stdata_obj)</span>
    <span class="c1">#         LOGGER.info(f&quot;Study data has been added.&quot;)</span>

    
        <span class="c1"># TODO: This should be also added to Database controller. </span>

        <span class="c1"># Check blob + description file hash values.</span>
        <span class="c1"># TODO</span>

        <span class="c1"># If the object is in the list of study_data retireve it from database.</span>
        <span class="c1"># TODO</span>

        <span class="c1"># If not, create an object of StudyData and put it inside:</span>
        <span class="c1"># 1) List of study_data</span>
        <span class="c1"># 2) database</span>
        <span class="c1"># 3) Any other controller list  and graph. </span>
    

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Project name: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pr_name</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>\
               <span class="sa">f</span><span class="s2">&quot;Project id: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pr_id</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>\
               <span class="sa">f</span><span class="s2">&quot;Project database: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pr_db_path</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>\
               <span class="sa">f</span><span class="s2">&quot;Number of gps objects: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gps_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Project(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pr_name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="c1"># check the yaml file --------------------------------------------------</span>
        <span class="k">if</span> <span class="s2">&quot;name&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please provide a project name.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please provide a project id.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="s2">&quot;data&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> \
                         <span class="bp">self</span><span class="o">.</span><span class="n">project_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;outcome_path&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> \
                         <span class="bp">self</span><span class="o">.</span><span class="n">project_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;covariate_path&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> \
                         <span class="bp">self</span><span class="o">.</span><span class="n">project_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;exposure_path&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please provide a path to the outcome, covariates and &quot;</span><span class="o">+</span>\
                  <span class="s2">&quot;treatment data.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># create a hash string </span>
        <span class="n">outcome_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;outcome_path&quot;</span><span class="p">)</span>
        <span class="n">exposure_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;exposure_path&quot;</span><span class="p">)</span>
        <span class="n">covariate_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;covariate_path&quot;</span><span class="p">)</span>

        <span class="n">outcome_name</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">outcome_path</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">exposure_name</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">exposure_path</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">covariate_name</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">covariate_path</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">hash_string</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)),</span> <span class="n">outcome_name</span><span class="p">,</span> <span class="n">exposure_name</span><span class="p">,</span> <span class="n">covariate_name</span><span class="p">])</span>

        <span class="k">try</span><span class="p">:</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">hash_value</span> <span class="o">=</span>  <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span>
                <span class="n">hash_string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">project_params</span><span class="p">[</span><span class="s2">&quot;hash_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_value</span>

    <span class="k">def</span> <span class="nf">summary_study_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">study_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;The project does not have any study data.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The project has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">study_data</span><span class="p">)</span><span class="si">}</span><span class="s2"> study data: &quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">study_data</span><span class="p">:</span>
                <span class="n">st_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">st_data</span><span class="o">.</span><span class="n">st_d_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">gps_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gps_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;The project does not have any gps.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The project has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gps_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> gps: &quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gps_list</span><span class="p">:</span>
                <span class="n">gps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">gps</span><span class="p">)</span>


<div class="viewcode-block" id="Project.get_gps"><a class="viewcode-back" href="../../modules.html#pycausalgps.project.Project.get_gps">[docs]</a>    <span class="k">def</span> <span class="nf">get_gps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gps_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a project object from the database.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        gps_id: str</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        | gps: GeneralizedPropensityScore</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">gps_id_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">gps_hash</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gps_list</span><span class="p">:</span>
               <span class="n">gps_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">gps_hash</span><span class="p">)</span>
               <span class="n">gps_id_dict</span><span class="p">[</span><span class="n">gps_obj</span><span class="o">.</span><span class="n">gps_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">gps_hash</span>

        <span class="k">if</span> <span class="n">gps_id</span> <span class="ow">in</span> <span class="n">gps_id_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span><span class="n">gps_id_dict</span><span class="p">[</span><span class="n">gps_id</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A GPS object with id:</span><span class="si">{</span><span class="n">gps_id</span><span class="si">}</span><span class="s2"> is not defined.&quot;</span><span class="p">)</span></div></div>
        


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">project_params</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">20221027</span><span class="p">,</span>
                       <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;cms_kidney_failure&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Computing the effect of longterm pm2.5 exposure on kidney failure.&#39;</span><span class="p">,</span> <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;1.0.0&#39;</span><span class="p">,</span> <span class="s1">&#39;authors&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Naeem Khoshnevis&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="s1">&#39;nkhoshnevis@g.harvard.edu&#39;</span><span class="p">}},</span> 
                       <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;outcome_path&#39;</span><span class="p">:</span> <span class="s1">&#39;/Users/nak443/Documents/Naeem_folder_mac_h/Research_projects/F2021_001_Harvard/experiment_001_20210210_Python_CausalGPS/analysis/pycausalgps/scripts2/project_abc/outcome.csv&#39;</span><span class="p">,</span> 
                                <span class="s1">&#39;exposure_path&#39;</span><span class="p">:</span> <span class="s1">&#39;/Users/nak443/Documents/Naeem_folder_mac_h/Research_projects/F2021_001_Harvard/experiment_001_20210210_Python_CausalGPS/analysis/pycausalgps/scripts2/project_abc/exposure.csv&#39;</span><span class="p">,</span> 
                                <span class="s1">&#39;covariate_path&#39;</span><span class="p">:</span> <span class="s1">&#39;/Users/nak443/Documents/Naeem_folder_mac_h/Research_projects/F2021_001_Harvard/experiment_001_20210210_Python_CausalGPS/analysis/pycausalgps/scripts2/project_abc/covariate.csv&#39;</span><span class="p">}}</span>

    <span class="n">current_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="n">db_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span> <span class="s2">&quot;database.sqlite&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">current_dir</span><span class="p">)</span>
    <span class="n">pr</span> <span class="o">=</span> <span class="n">Project</span><span class="p">(</span><span class="n">project_params</span><span class="p">,</span> <span class="n">db_path</span><span class="p">)</span>
    <span class="n">pr</span><span class="o">.</span><span class="n">compute_gps</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span><span class="s2">&quot;scripts2/project_abc&quot;</span><span class="p">,</span> <span class="s2">&quot;gps_params.yaml&quot;</span><span class="p">))</span>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Harvard University 2021.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>